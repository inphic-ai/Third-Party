# ç”¨æˆ¶å¯©æ ¸ç³»çµ±å®Œæ•´èªªæ˜

## ç³»çµ±æ¦‚è¿°

Third-Party ç®¡ç†ç³»çµ±å·²æˆåŠŸå¯¦ç¾å®Œæ•´çš„ç”¨æˆ¶å¯©æ ¸å·¥ä½œæµç¨‹ã€‚ç•¶æ–°ç”¨æˆ¶é€é Google OAuth ç™»å…¥æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•å°‡å…¶æ¨™è¨˜ç‚ºã€Œå¾…å¯©æ ¸ã€ç‹€æ…‹ï¼Œä¸¦ç­‰å¾…ç®¡ç†å“¡æ‰¹å‡†å¾Œæ‰èƒ½ä½¿ç”¨ç³»çµ±åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§

âœ… **è‡ªå‹•å¯©æ ¸æµç¨‹**ï¼šæ–°ç”¨æˆ¶è‡ªå‹•é€²å…¥å¾…å¯©æ ¸ç‹€æ…‹  
âœ… **ä¸‰åˆ†é ç®¡ç†ä»‹é¢**ï¼šå·²å•Ÿç”¨ã€å¾…å¯©æ ¸ã€å·²æ‹’çµ•  
âœ… **éƒ¨é–€åˆ†é…**ï¼šæ‰¹å‡†æ™‚å¯æŒ‡å®šç”¨æˆ¶æ‰€å±¬éƒ¨é–€  
âœ… **éƒµä»¶é€šçŸ¥**ï¼šæ‰¹å‡†/æ‹’çµ•æ™‚è‡ªå‹•ç™¼é€é€šçŸ¥éƒµä»¶  
âœ… **è§£é™¤å°é–**ï¼šå¯å°‡å·²æ‹’çµ•ç”¨æˆ¶é‡æ–°è¨­ç‚ºå¾…å¯©æ ¸  
âœ… **æ¬Šé™æ§ç®¡**ï¼šåƒ…ç®¡ç†å“¡å¯åŸ·è¡Œå¯©æ ¸æ“ä½œ  

---

## ç³»çµ±æ¶æ§‹

### è³‡æ–™åº«çµæ§‹

#### users è¡¨ï¼ˆç”¨æˆ¶è¡¨ï¼‰

æ–°å¢æ¬„ä½ï¼š

```sql
status VARCHAR(20) DEFAULT 'pending'  -- ç”¨æˆ¶ç‹€æ…‹ï¼špending/approved/rejected
department VARCHAR(255)               -- æ‰€å±¬éƒ¨é–€ ID
approved_by VARCHAR(255)              -- æ‰¹å‡†è€… ID
approved_at TIMESTAMP                 -- æ‰¹å‡†æ™‚é–“
rejection_reason TEXT                 -- æ‹’çµ•åŸå› 
```

#### departments è¡¨ï¼ˆéƒ¨é–€è¡¨ï¼‰

```sql
id VARCHAR(255) PRIMARY KEY
name VARCHAR(255) NOT NULL
description TEXT
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
```

é è¨­éƒ¨é–€ï¼š
- IT éƒ¨é–€
- äººè³‡éƒ¨é–€
- è²¡å‹™éƒ¨é–€
- æ¥­å‹™éƒ¨é–€
- è¡Œæ”¿éƒ¨é–€

### æ ¸å¿ƒæª”æ¡ˆ

| æª”æ¡ˆè·¯å¾‘ | åŠŸèƒ½èªªæ˜ |
|---------|---------|
| `app/routes/admin.tsx` | ç®¡ç†å¾Œå°ä¸»é é¢ï¼ŒåŒ…å« action å‡½æ•¸è™•ç†å¯©æ ¸æ“ä½œ |
| `app/components/UserManager.tsx` | ç”¨æˆ¶ç®¡ç†å…ƒä»¶ï¼Œä¸‰åˆ†é ä»‹é¢ |
| `app/services/auth.server.ts` | èªè­‰æœå‹™ï¼Œè™•ç†ç™»å…¥æ™‚çš„ç‹€æ…‹æª¢æŸ¥ |
| `app/services/email.server.ts` | éƒµä»¶æœå‹™ï¼Œç™¼é€æ‰¹å‡†/æ‹’çµ•é€šçŸ¥ |
| `app/routes/waiting-approval.tsx` | å¾…å¯©æ ¸ç”¨æˆ¶çœ‹åˆ°çš„é é¢ |
| `app/routes/access-denied.tsx` | è¢«æ‹’çµ•ç”¨æˆ¶çœ‹åˆ°çš„é é¢ |
| `db/schema/user.ts` | ç”¨æˆ¶è³‡æ–™è¡¨çµæ§‹å®šç¾© |
| `db/schema/department.ts` | éƒ¨é–€è³‡æ–™è¡¨çµæ§‹å®šç¾© |
| `db/migrations/add_user_approval_system.sql` | è³‡æ–™åº«é·ç§» SQL |

---

## åŠŸèƒ½æµç¨‹

### 1. æ–°ç”¨æˆ¶è¨»å†Šæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ¶é»æ“Š Google ç™»å…¥] --> B{æ˜¯å¦ç‚ºæ–°ç”¨æˆ¶?}
    B -->|æ˜¯| C[å»ºç«‹ç”¨æˆ¶è¨˜éŒ„]
    C --> D[è¨­å®š status = pending]
    D --> E[å°å‘ /waiting-approval]
    E --> F[é¡¯ç¤ºç­‰å¾…å¯©æ ¸é é¢]
    B -->|å¦| G{æª¢æŸ¥ç”¨æˆ¶ç‹€æ…‹}
    G -->|approved| H[é€²å…¥ç³»çµ±]
    G -->|pending| E
    G -->|rejected| I[å°å‘ /access-denied]
```

**å¯¦ä½œç´°ç¯€**ï¼š

1. ç”¨æˆ¶é€é Google OAuth å®Œæˆèªè­‰
2. ç³»çµ±æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²å­˜åœ¨æ–¼è³‡æ–™åº«
3. å¦‚æœæ˜¯æ–°ç”¨æˆ¶ï¼š
   - å»ºç«‹ç”¨æˆ¶è¨˜éŒ„ï¼Œstatus é è¨­ç‚º 'pending'
   - é‡æ–°å°å‘åˆ° `/waiting-approval`
4. å¦‚æœæ˜¯ç¾æœ‰ç”¨æˆ¶ï¼š
   - æª¢æŸ¥ status æ¬„ä½
   - pending â†’ `/waiting-approval`
   - approved â†’ é€²å…¥ç³»çµ±
   - rejected â†’ `/access-denied`

### 2. ç®¡ç†å“¡å¯©æ ¸æµç¨‹

```mermaid
graph TD
    A[ç®¡ç†å“¡ç™»å…¥ç³»çµ±] --> B[å‰å¾€ç³»çµ±ç®¡ç†é é¢]
    B --> C[é»æ“Šäººå“¡æ¬Šé™åˆ†é ]
    C --> D[åˆ‡æ›åˆ°å¾…å¯©æ ¸åˆ†é ]
    D --> E{é¸æ“‡æ“ä½œ}
    E -->|æ‰¹å‡†| F[é¸æ“‡éƒ¨é–€]
    F --> G[æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ç‚º approved]
    G --> H[ç™¼é€æ‰¹å‡†éƒµä»¶]
    H --> I[ç”¨æˆ¶ç§»è‡³å·²å•Ÿç”¨åˆ†é ]
    E -->|æ‹’çµ•| J[è¼¸å…¥æ‹’çµ•åŸå› ]
    J --> K[æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ç‚º rejected]
    K --> L[ç™¼é€æ‹’çµ•éƒµä»¶]
    L --> M[ç”¨æˆ¶ç§»è‡³å·²æ‹’çµ•åˆ†é ]
```

**å¯¦ä½œç´°ç¯€**ï¼š

#### æ‰¹å‡†æ“ä½œ

1. ç®¡ç†å“¡åœ¨å¾…å¯©æ ¸åˆ†é é»æ“Šã€Œæ‰¹å‡†ã€æŒ‰éˆ•
2. å½ˆå‡ºå°è©±æ¡†ï¼Œé¸æ“‡ç”¨æˆ¶æ‰€å±¬éƒ¨é–€
3. æäº¤è¡¨å–®ï¼Œè§¸ç™¼ `approveUser` action
4. å¾Œç«¯åŸ·è¡Œï¼š
   ```typescript
   - æŸ¥è©¢ç”¨æˆ¶è³‡æ–™
   - æŸ¥è©¢éƒ¨é–€è³‡æ–™
   - æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ï¼š
     * status = 'approved'
     * department = é¸æ“‡çš„éƒ¨é–€ ID
     * approved_by = ç•¶å‰ç®¡ç†å“¡ ID
     * approved_at = ç•¶å‰æ™‚é–“
   - ç™¼é€æ‰¹å‡†éƒµä»¶
   ```
5. è¿”å›æˆåŠŸè¨Šæ¯

#### æ‹’çµ•æ“ä½œ

1. ç®¡ç†å“¡åœ¨å¾…å¯©æ ¸åˆ†é é»æ“Šã€Œæ‹’çµ•ã€æŒ‰éˆ•
2. å½ˆå‡ºå°è©±æ¡†ï¼Œè¼¸å…¥æ‹’çµ•åŸå› 
3. æäº¤è¡¨å–®ï¼Œè§¸ç™¼ `rejectUser` action
4. å¾Œç«¯åŸ·è¡Œï¼š
   ```typescript
   - æŸ¥è©¢ç”¨æˆ¶è³‡æ–™
   - æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ï¼š
     * status = 'rejected'
     * rejection_reason = è¼¸å…¥çš„åŸå› 
   - ç™¼é€æ‹’çµ•éƒµä»¶
   ```
5. è¿”å›æˆåŠŸè¨Šæ¯

### 3. è§£é™¤å°é–æµç¨‹

```mermaid
graph TD
    A[ç®¡ç†å“¡åœ¨å·²æ‹’çµ•åˆ†é ] --> B[é»æ“Šè§£é™¤å°é–æŒ‰éˆ•]
    B --> C[ç¢ºèªå°è©±æ¡†]
    C --> D[æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ç‚º pending]
    D --> E[æ¸…é™¤æ‹’çµ•åŸå› ]
    E --> F[ç”¨æˆ¶ç§»è‡³å¾…å¯©æ ¸åˆ†é ]
    F --> G[å¯é‡æ–°é€²è¡Œå¯©æ ¸]
```

**å¯¦ä½œç´°ç¯€**ï¼š

1. ç®¡ç†å“¡åœ¨å·²æ‹’çµ•åˆ†é æ‰¾åˆ°ç”¨æˆ¶
2. é»æ“Šã€Œè§£é™¤å°é–ã€æŒ‰éˆ•
3. ç¢ºèªæ“ä½œ
4. å¾Œç«¯åŸ·è¡Œï¼š
   ```typescript
   - æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ï¼š
     * status = 'pending'
     * rejection_reason = null
   ```
5. ç”¨æˆ¶é‡æ–°å‡ºç¾åœ¨å¾…å¯©æ ¸åˆ—è¡¨

---

## éƒµä»¶é€šçŸ¥ç³»çµ±

### æ‰¹å‡†é€šçŸ¥éƒµä»¶

**ä¸»æ—¨**ï¼šâœ… æ‚¨çš„å¸³è™Ÿå·²é€šéå¯©æ ¸

**å…§å®¹åŒ…å«**ï¼š
- æ­¡è¿è¨Šæ¯
- ç”¨æˆ¶å§“å
- åˆ†é…çš„éƒ¨é–€
- ç™»å…¥ç³»çµ±çš„é€£çµ
- è¯ç¹«è³‡è¨Š

**ç¯„æœ¬é è¦½**ï¼š

```html
ğŸ‰ å¸³è™Ÿå¯©æ ¸é€šé

è¦ªæ„›çš„ [ç”¨æˆ¶å§“å]ï¼Œæ‚¨å¥½ï¼š

æ­å–œæ‚¨ï¼æ‚¨çš„ Third-Party ç®¡ç†ç³»çµ±å¸³è™Ÿå·²é€šéç®¡ç†å“¡å¯©æ ¸ï¼Œ
ç¾åœ¨å¯ä»¥é–‹å§‹ä½¿ç”¨ç³»çµ±äº†ã€‚

å¸³è™Ÿè³‡è¨Šï¼š
â€¢ å§“åï¼š[ç”¨æˆ¶å§“å]
â€¢ Emailï¼š[ç”¨æˆ¶éƒµç®±]
â€¢ éƒ¨é–€ï¼š[éƒ¨é–€åç¨±]

[ç«‹å³ç™»å…¥ç³»çµ±]

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡ã€‚
```

### æ‹’çµ•é€šçŸ¥éƒµä»¶

**ä¸»æ—¨**ï¼šâŒ æ‚¨çš„å¸³è™Ÿç”³è«‹æœªé€šéå¯©æ ¸

**å…§å®¹åŒ…å«**ï¼š
- æ‹’çµ•é€šçŸ¥
- ç”¨æˆ¶å§“å
- æ‹’çµ•åŸå› 
- è¯ç¹«ç®¡ç†å“¡çš„æç¤º

**ç¯„æœ¬é è¦½**ï¼š

```html
å¸³è™Ÿç”³è«‹æœªé€šé

è¦ªæ„›çš„ [ç”¨æˆ¶å§“å]ï¼Œæ‚¨å¥½ï¼š

å¾ˆéºæ†¾é€šçŸ¥æ‚¨ï¼Œæ‚¨çš„ Third-Party ç®¡ç†ç³»çµ±å¸³è™Ÿç”³è«‹æœªé€šéå¯©æ ¸ã€‚

æ‹’çµ•åŸå› ï¼š
[ç®¡ç†å“¡è¼¸å…¥çš„åŸå› ]

å¦‚æœæ‚¨èªç‚ºé€™æ˜¯ä¸€å€‹éŒ¯èª¤ï¼Œæˆ–éœ€è¦é€²ä¸€æ­¥èªªæ˜ï¼Œ
è«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡ã€‚

æ„Ÿè¬æ‚¨çš„ç†è§£èˆ‡é…åˆã€‚
```

### éƒµä»¶æœå‹™è¨­å®š

ä½¿ç”¨ **Resend** ä½œç‚ºéƒµä»¶ç™¼é€æœå‹™ï¼š

**ç’°å¢ƒè®Šæ•¸**ï¼š
```env
RESEND_API_KEY=re_xxxxxxxxxxxx
FROM_EMAIL=noreply@yourdomain.com
FROM_NAME=Third-Party ç®¡ç†ç³»çµ±
APP_URL=https://your-domain.com
```

**è¨­å®šæ­¥é©Ÿ**ï¼š
1. è¨»å†Š Resend å¸³è™Ÿ
2. é©—è­‰ç™¼ä¿¡ç¶²åŸŸ
3. å–å¾— API Key
4. è¨­å®šç’°å¢ƒè®Šæ•¸

è©³ç´°èªªæ˜è«‹åƒè€ƒï¼š[EMAIL_SETUP.md](./EMAIL_SETUP.md)

---

## ä½¿ç”¨è€…ä»‹é¢

### ç®¡ç†å“¡ä»‹é¢

#### äººå“¡æ¬Šé™ç®¡ç†é é¢

**ä½ç½®**ï¼šç³»çµ±ç®¡ç† > äººå“¡æ¬Šé™

**ä¸‰å€‹åˆ†é **ï¼š

1. **å·²å•Ÿç”¨** (ç¶ è‰²æ¨™è¨˜)
   - é¡¯ç¤ºæ‰€æœ‰ status = 'approved' çš„ç”¨æˆ¶
   - é¡¯ç¤ºç”¨æˆ¶å§“åã€Emailã€éƒ¨é–€ã€è§’è‰²
   - é¡¯ç¤ºã€Œå·²å•Ÿç”¨ã€ç¶ è‰²å¾½ç« 

2. **å¾…å¯©æ ¸** (æ©˜è‰²æ¨™è¨˜ï¼Œæœ‰æ•¸å­—å¾½ç« )
   - é¡¯ç¤ºæ‰€æœ‰ status = 'pending' çš„ç”¨æˆ¶
   - é¡¯ç¤ºç”¨æˆ¶å§“åã€Emailã€è¨»å†Šæ™‚é–“
   - æä¾›ã€Œæ‰¹å‡†ã€å’Œã€Œæ‹’çµ•ã€æŒ‰éˆ•
   - æ©˜è‰²èƒŒæ™¯çªé¡¯å¾…è™•ç†é …ç›®

3. **å·²æ‹’çµ•** (ç´…è‰²æ¨™è¨˜)
   - é¡¯ç¤ºæ‰€æœ‰ status = 'rejected' çš„ç”¨æˆ¶
   - é¡¯ç¤ºç”¨æˆ¶å§“åã€Emailã€æ‹’çµ•åŸå› 
   - æä¾›ã€Œè§£é™¤å°é–ã€æŒ‰éˆ•
   - ç´…è‰²èƒŒæ™¯æ¨™ç¤ºå·²æ‹’çµ•ç‹€æ…‹

#### æ‰¹å‡†å°è©±æ¡†

- é¡¯ç¤ºç”¨æˆ¶è³‡è¨Šï¼ˆå§“åã€Emailï¼‰
- éƒ¨é–€ä¸‹æ‹‰é¸å–®ï¼ˆå¿…é¸ï¼‰
- å–æ¶ˆ / ç¢ºèªæ‰¹å‡†æŒ‰éˆ•

#### æ‹’çµ•å°è©±æ¡†

- é¡¯ç¤ºç”¨æˆ¶è³‡è¨Šï¼ˆå§“åã€Emailï¼‰
- æ‹’çµ•åŸå› æ–‡å­—æ¡†ï¼ˆå¿…å¡«ï¼Œå¤šè¡Œï¼‰
- å–æ¶ˆ / ç¢ºèªæ‹’çµ•æŒ‰éˆ•

### ç”¨æˆ¶ä»‹é¢

#### ç­‰å¾…å¯©æ ¸é é¢ (`/waiting-approval`)

**é¡¯ç¤ºå…§å®¹**ï¼š
- æ™‚é˜åœ–ç¤º
- ã€Œç­‰å¾…ç®¡ç†å“¡å¯©æ ¸ã€æ¨™é¡Œ
- èªªæ˜æ–‡å­—ï¼šã€Œæ‚¨çš„å¸³è™Ÿæ­£åœ¨ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸...ã€
- é è¨ˆå¯©æ ¸æ™‚é–“æç¤º
- è¯ç¹«è³‡è¨Š

**ç‰¹é»**ï¼š
- ç°¡æ½”å‹å–„çš„è¨­è¨ˆ
- ç„¡æ³•è¨ªå•ç³»çµ±å…¶ä»–é é¢
- è‡ªå‹•æª¢æŸ¥å¯©æ ¸ç‹€æ…‹ï¼ˆå¯é‡æ–°ç™»å…¥æŸ¥çœ‹ï¼‰

#### æ‹’çµ•é é¢ (`/access-denied`)

**é¡¯ç¤ºå…§å®¹**ï¼š
- ç¦æ­¢åœ–ç¤º
- ã€Œå¸³è™Ÿç”³è«‹æœªé€šéã€æ¨™é¡Œ
- æ‹’çµ•åŸå› ï¼ˆå¾è³‡æ–™åº«è®€å–ï¼‰
- è¯ç¹«ç®¡ç†å“¡çš„æç¤º
- è¿”å›ç™»å…¥é é¢çš„é€£çµ

**ç‰¹é»**ï¼š
- æ¸…æ¥šèªªæ˜æ‹’çµ•åŸå› 
- æä¾›è¯ç¹«æ–¹å¼
- ç„¡æ³•é€²å…¥ç³»çµ±

---

## API ç«¯é»

### Admin Action å‡½æ•¸

**è·¯å¾‘**ï¼š`/admin` (POST)

#### æ‰¹å‡†ç”¨æˆ¶

**åƒæ•¸**ï¼š
```typescript
{
  intent: 'approveUser',
  userId: string,
  departmentId: string
}
```

**å›æ‡‰**ï¼š
```typescript
{
  success: true,
  message: 'ç”¨æˆ¶å·²æ‰¹å‡†ï¼Œé€šçŸ¥éƒµä»¶å·²ç™¼é€'
}
```

#### æ‹’çµ•ç”¨æˆ¶

**åƒæ•¸**ï¼š
```typescript
{
  intent: 'rejectUser',
  userId: string,
  reason: string
}
```

**å›æ‡‰**ï¼š
```typescript
{
  success: true,
  message: 'ç”¨æˆ¶å·²æ‹’çµ•ï¼Œé€šçŸ¥éƒµä»¶å·²ç™¼é€'
}
```

#### è§£é™¤å°é–

**åƒæ•¸**ï¼š
```typescript
{
  intent: 'unblockUser',
  userId: string
}
```

**å›æ‡‰**ï¼š
```typescript
{
  success: true,
  message: 'ç”¨æˆ¶å·²è§£é™¤å°é–ï¼Œç‹€æ…‹æ”¹ç‚ºå¾…å¯©æ ¸'
}
```

---

## æ¬Šé™æ§ç®¡

### ç®¡ç†å“¡æ¬Šé™

**æª¢æŸ¥æ–¹å¼**ï¼š`requireAdmin(request)`

**åŠŸèƒ½**ï¼š
- é©—è­‰ç”¨æˆ¶æ˜¯å¦ç‚ºç®¡ç†å“¡
- éç®¡ç†å“¡è¨ªå• `/admin` æœƒè¢«æ‹’çµ•
- è¿”å› 403 æˆ–é‡æ–°å°å‘

**å¯¦ä½œ**ï¼š
```typescript
export async function loader({ request }: LoaderFunctionArgs) {
  await requireAdmin(request);
  // ... è¼‰å…¥è³‡æ–™
}

export async function action({ request }: ActionFunctionArgs) {
  await requireAdmin(request);
  // ... è™•ç†æ“ä½œ
}
```

### ç”¨æˆ¶æ¬Šé™

**æª¢æŸ¥æ–¹å¼**ï¼š`requireUser(request)`

**åŠŸèƒ½**ï¼š
- é©—è­‰ç”¨æˆ¶æ˜¯å¦å·²ç™»å…¥
- æª¢æŸ¥ç”¨æˆ¶ç‹€æ…‹ï¼ˆpending/approved/rejectedï¼‰
- æ ¹æ“šç‹€æ…‹é‡æ–°å°å‘åˆ°å°æ‡‰é é¢

**å¯¦ä½œ**ï¼š
```typescript
export async function loader({ request }: LoaderFunctionArgs) {
  const user = await requireUser(request);
  // user.status å·²ç¶“éæª¢æŸ¥ï¼Œé€™è£¡ä¸€å®šæ˜¯ 'approved'
}
```

---

## è³‡æ–™åº«é·ç§»

### åŸ·è¡Œé·ç§»

**SQL æª”æ¡ˆ**ï¼š`db/migrations/add_user_approval_system.sql`

**åŸ·è¡Œæ–¹å¼**ï¼š

```bash
# ä½¿ç”¨ psql
psql $DATABASE_URL < db/migrations/add_user_approval_system.sql

# æˆ–ä½¿ç”¨ Railway CLI
railway run psql < db/migrations/add_user_approval_system.sql
```

**é·ç§»å…§å®¹**ï¼š

1. ä¿®æ”¹ users è¡¨ï¼Œæ–°å¢æ¬„ä½
2. å»ºç«‹ departments è¡¨
3. æ’å…¥é è¨­éƒ¨é–€è³‡æ–™
4. å°‡ç¾æœ‰ç”¨æˆ¶ç‹€æ…‹è¨­ç‚º 'approved'

### å›æ»¾ï¼ˆå¦‚éœ€è¦ï¼‰

```sql
-- ç§»é™¤æ–°å¢çš„æ¬„ä½
ALTER TABLE users DROP COLUMN IF EXISTS status;
ALTER TABLE users DROP COLUMN IF EXISTS department;
ALTER TABLE users DROP COLUMN IF EXISTS approved_by;
ALTER TABLE users DROP COLUMN IF EXISTS approved_at;
ALTER TABLE users DROP COLUMN IF EXISTS rejection_reason;

-- åˆªé™¤ departments è¡¨
DROP TABLE IF EXISTS departments;
```

---

## éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰

- [ ] è³‡æ–™åº«é·ç§»å·²åŸ·è¡Œ
- [ ] ç’°å¢ƒè®Šæ•¸å·²è¨­å®šï¼ˆDATABASE_URL, GOOGLE_*, RESEND_API_KEY, etc.ï¼‰
- [ ] Resend ç¶²åŸŸå·²é©—è­‰
- [ ] æ¸¬è©¦éƒµä»¶ç™¼é€æˆåŠŸ
- [ ] æœ¬åœ°æ¸¬è©¦é€šé

### éƒ¨ç½²å¾Œ

- [ ] ç¢ºèª Railway ç’°å¢ƒè®Šæ•¸æ­£ç¢º
- [ ] æª¢æŸ¥è³‡æ–™åº«é€£ç·šæ­£å¸¸
- [ ] æ¸¬è©¦æ–°ç”¨æˆ¶è¨»å†Šæµç¨‹
- [ ] æ¸¬è©¦ç®¡ç†å“¡å¯©æ ¸æµç¨‹
- [ ] æ¸¬è©¦éƒµä»¶é€šçŸ¥åŠŸèƒ½
- [ ] æª¢æŸ¥æ—¥èªŒç„¡éŒ¯èª¤

### ç’°å¢ƒè®Šæ•¸æ¸…å–®

```env
# å¿…é ˆè¨­å®š
DATABASE_URL=postgresql://...
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...
GOOGLE_REDIRECT_URI=...
SESSION_SECRET=...
RESEND_API_KEY=...
FROM_EMAIL=...
APP_URL=...

# å¯é¸è¨­å®š
FROM_NAME=Third-Party ç®¡ç†ç³»çµ±
NODE_ENV=production
PORT=3000
```

---

## å¸¸è¦‹å•é¡Œ (FAQ)

### Q1: æ–°ç”¨æˆ¶ç„¡æ³•ç™»å…¥ï¼Ÿ

**A**: æª¢æŸ¥ç”¨æˆ¶çš„ status æ¬„ä½ï¼š
- å¦‚æœæ˜¯ 'pending'ï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼Œéœ€è¦ç­‰å¾…ç®¡ç†å“¡æ‰¹å‡†
- å¦‚æœæ˜¯ 'rejected'ï¼Œéœ€è¦ç®¡ç†å“¡è§£é™¤å°é–
- å¦‚æœæ˜¯ 'approved'ï¼Œæª¢æŸ¥å…¶ä»–ç™»å…¥å•é¡Œ

### Q2: éƒµä»¶æ²’æœ‰ç™¼é€ï¼Ÿ

**A**: æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š
1. RESEND_API_KEY æ˜¯å¦æ­£ç¢º
2. FROM_EMAIL çš„ç¶²åŸŸæ˜¯å¦å·²é©—è­‰
3. æŸ¥çœ‹ä¼ºæœå™¨æ—¥èªŒä¸­çš„éŒ¯èª¤è¨Šæ¯
4. æª¢æŸ¥ Resend Dashboard çš„ç™¼é€è¨˜éŒ„

### Q3: å¦‚ä½•æ–°å¢éƒ¨é–€ï¼Ÿ

**A**: ç›®å‰éœ€è¦ç›´æ¥åœ¨è³‡æ–™åº«ä¸­æ–°å¢ï¼š
```sql
INSERT INTO departments (id, name, description)
VALUES ('new-dept-id', 'æ–°éƒ¨é–€åç¨±', 'éƒ¨é–€èªªæ˜');
```

æœªä¾†ç‰ˆæœ¬æœƒæä¾›ç®¡ç†ä»‹é¢ã€‚

### Q4: å¦‚ä½•å°‡ç¾æœ‰ç”¨æˆ¶è¨­ç‚ºç®¡ç†å“¡ï¼Ÿ

**A**: åœ¨è³‡æ–™åº«ä¸­æ›´æ–°ï¼š
```sql
UPDATE users
SET role = 'admin'
WHERE email = 'user@example.com';
```

### Q5: æ‰¹å‡†æ™‚å¿˜è¨˜é¸æ“‡éƒ¨é–€æ€éº¼è¾¦ï¼Ÿ

**A**: ç³»çµ±æœƒé˜»æ­¢æäº¤ï¼Œå¿…é ˆé¸æ“‡éƒ¨é–€ã€‚å¦‚æœå·²ç¶“æ‰¹å‡†ä½†æƒ³ä¿®æ”¹éƒ¨é–€ï¼Œéœ€è¦åœ¨è³‡æ–™åº«ä¸­æ‰‹å‹•æ›´æ–°ã€‚

### Q6: å¯ä»¥æ‰¹é‡æ‰¹å‡†ç”¨æˆ¶å—ï¼Ÿ

**A**: ç›®å‰ä¸æ”¯æ´æ‰¹é‡æ“ä½œï¼Œéœ€è¦é€ä¸€æ‰¹å‡†ã€‚é€™æ˜¯æœªä¾†ç‰ˆæœ¬çš„æ”¹é€²é …ç›®ã€‚

### Q7: ç”¨æˆ¶è¢«æ‹’çµ•å¾Œå¯ä»¥é‡æ–°ç”³è«‹å—ï¼Ÿ

**A**: å¯ä»¥ã€‚ç®¡ç†å“¡å¯ä»¥ä½¿ç”¨ã€Œè§£é™¤å°é–ã€åŠŸèƒ½ï¼Œå°‡ç”¨æˆ¶ç‹€æ…‹æ”¹å› 'pending'ï¼Œç„¶å¾Œé‡æ–°å¯©æ ¸ã€‚

### Q8: éƒµä»¶æœƒé€²å…¥åƒåœ¾éƒµä»¶åŒ£å—ï¼Ÿ

**A**: å¯èƒ½æœƒã€‚å»ºè­°ï¼š
- ç¢ºä¿ DNS è¨˜éŒ„ï¼ˆSPFã€DKIMï¼‰æ­£ç¢ºè¨­å®š
- ä½¿ç”¨å·²é©—è­‰çš„å°ˆæ¥­ç¶²åŸŸ
- é¿å…ä½¿ç”¨ä¿ƒéŠ·æ€§èªè¨€

---

## ç³»çµ±é™åˆ¶

### ç•¶å‰é™åˆ¶

1. **éƒ¨é–€ç®¡ç†**ï¼š
   - ç„¡æ³•é€éä»‹é¢æ–°å¢/ç·¨è¼¯/åˆªé™¤éƒ¨é–€
   - éœ€è¦ç›´æ¥æ“ä½œè³‡æ–™åº«

2. **æ‰¹é‡æ“ä½œ**ï¼š
   - ç„¡æ³•æ‰¹é‡æ‰¹å‡†æˆ–æ‹’çµ•ç”¨æˆ¶
   - éœ€è¦é€ä¸€è™•ç†

3. **å¯©æ ¸æ­·å²**ï¼š
   - ç„¡æ³•æŸ¥çœ‹å¯©æ ¸æ­·å²è¨˜éŒ„
   - åªèƒ½çœ‹åˆ°æœ€çµ‚ç‹€æ…‹

4. **éƒµä»¶ç¯„æœ¬**ï¼š
   - ç„¡æ³•é€éä»‹é¢è‡ªè¨‚éƒµä»¶å…§å®¹
   - éœ€è¦ä¿®æ”¹ç¨‹å¼ç¢¼

5. **é€šçŸ¥è¨­å®š**ï¼š
   - ç„¡æ³•è¨­å®šæ˜¯å¦ç™¼é€éƒµä»¶
   - æ‰¹å‡†/æ‹’çµ•æ™‚ä¸€å®šæœƒç™¼é€

### æœªä¾†æ”¹é€²

- [ ] éƒ¨é–€ç®¡ç†ä»‹é¢
- [ ] æ‰¹é‡å¯©æ ¸åŠŸèƒ½
- [ ] å¯©æ ¸æ­·å²è¨˜éŒ„
- [ ] éƒµä»¶ç¯„æœ¬ç·¨è¼¯å™¨
- [ ] é€šçŸ¥è¨­å®šé¸é …
- [ ] ç”¨æˆ¶ç”³è«‹æ™‚çš„è‡ªæˆ‘ä»‹ç´¹æ¬„ä½
- [ ] å¯©æ ¸æµç¨‹çš„å‚™è¨»åŠŸèƒ½
- [ ] å¯©æ ¸çµ±è¨ˆå ±è¡¨

---

## æŠ€è¡“ç´°ç¯€

### æŠ€è¡“æ£§

- **å‰ç«¯**ï¼šReact, Remix, TypeScript, Tailwind CSS
- **å¾Œç«¯**ï¼šRemix Server Actions, Drizzle ORM
- **è³‡æ–™åº«**ï¼šPostgreSQL (Railway)
- **èªè­‰**ï¼šGoogle OAuth 2.0
- **éƒµä»¶**ï¼šResend
- **éƒ¨ç½²**ï¼šRailway

### æ•ˆèƒ½è€ƒé‡

- ç”¨æˆ¶åˆ—è¡¨ä½¿ç”¨åˆ†é ï¼ˆç›®å‰æœªå¯¦ä½œï¼Œä½†è³‡æ–™é‡å°æ™‚ç„¡å½±éŸ¿ï¼‰
- éƒµä»¶ç™¼é€ç‚ºéé˜»å¡æ“ä½œ
- è³‡æ–™åº«æŸ¥è©¢å·²å„ªåŒ–ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰

### å®‰å…¨æ€§

- æ‰€æœ‰å¯©æ ¸æ“ä½œéœ€è¦ç®¡ç†å“¡æ¬Šé™
- ä½¿ç”¨ CSRF ä¿è­·ï¼ˆRemix å…§å»ºï¼‰
- è³‡æ–™åº«æ“ä½œä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢ï¼ˆé˜² SQL æ³¨å…¥ï¼‰
- Session ä½¿ç”¨åŠ å¯†å„²å­˜

---

## ç›¸é—œæ–‡ä»¶

- [éƒµä»¶æœå‹™è¨­å®šæŒ‡å—](./EMAIL_SETUP.md)
- [æ¸¬è©¦æ¸…å–®](./USER_APPROVAL_TESTING.md)
- [è³‡æ–™åº«é·ç§» SQL](../db/migrations/add_user_approval_system.sql)

---

## ç‰ˆæœ¬è³‡è¨Š

**ç‰ˆæœ¬**ï¼š1.0.0  
**ç™¼å¸ƒæ—¥æœŸ**ï¼š2026-02-03  
**ä½œè€…**ï¼šManus AI Agent  
**ç¶­è­·è€…**ï¼šThird-Party é–‹ç™¼åœ˜éšŠ

---

## æˆæ¬Šèˆ‡æ”¯æ´

æœ¬åŠŸèƒ½ç‚º Third-Party ç®¡ç†ç³»çµ±çš„ä¸€éƒ¨åˆ†ã€‚

**æŠ€è¡“æ”¯æ´**ï¼š
- GitHub Issues: https://github.com/inphic-ai/Third-Party/issues
- ç³»çµ±ç®¡ç†å“¡ï¼škipoteam@...

**æ›´æ–°æ—¥èªŒ**ï¼š
- 2026-02-03: åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
  - ç”¨æˆ¶å¯©æ ¸ç³»çµ±
  - ä¸‰åˆ†é ç®¡ç†ä»‹é¢
  - éƒµä»¶é€šçŸ¥åŠŸèƒ½
  - è§£é™¤å°é–åŠŸèƒ½
