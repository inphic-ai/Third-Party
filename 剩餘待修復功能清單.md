# 剩餘待修復功能清單

**總計：12 個功能缺口**

---

## 🔴 P0 嚴重缺口（3 個）

### 1. 通訊中心進階功能
**位置**：`app/routes/communication.tsx`

**缺失功能**：
- **編輯通訊群組**：點擊群組卡片上的設定按鈕，可編輯群組名稱、平台、邀請連結
- **刪除通訊群組**：在編輯模態框中提供刪除按鈕，確認後刪除群組
- **編輯聯繫紀錄**：點擊聯繫紀錄卡片上的編輯按鈕，可修改聯繫內容、狀態、備註
- **刪除聯繫紀錄**：在編輯模態框中提供刪除按鈕，確認後刪除紀錄

**技術要點**：
- 使用 `intent="editGroup"` 和 `intent="deleteGroup"` 處理群組操作
- 使用 `intent="editLog"` 和 `intent="deleteLog"` 處理聯繫紀錄操作
- 需要建立編輯模態框，預填現有資料
- 刪除操作需要二次確認

**資料表**：
- `social_groups`（群組資料）
- `contact_logs`（聯繫紀錄）

---

### 2. 日常任務手動新增功能
**位置**：`app/routes/tasks.tsx`

**缺失功能**：
- **新增任務按鈕**：點擊「+ 新增任務」按鈕，開啟新增任務模態框
- **任務表單欄位**：
  - 任務標題（必填）
  - 任務描述
  - 優先級（高/中/低）
  - 截止日期
  - 負責人（可選）
  - 關聯廠商（可選）
- **儲存任務**：提交表單後，新增任務至資料庫

**技術要點**：
- 使用 `intent="createTask"` 處理新增操作
- 需要建立新增任務模態框
- 優先級使用下拉選單（HIGH/MEDIUM/LOW）
- 截止日期使用日期選擇器

**資料表**：
- `tasks`（任務資料）

---

### 3. 廠商詳細頁面 - 通訊中心進階功能
**位置**：`app/routes/vendors_.$id.tsx` - Contacts Tab

**缺失功能**：
- **編輯通訊群組**：點擊群組卡片上的設定按鈕（已有 UI，但功能未實作）
- **刪除通訊群組**：在編輯模態框中提供刪除按鈕
- **編輯聯絡窗口**：點擊聯絡人卡片上的編輯按鈕（UI 可能缺失）
- **刪除聯絡窗口**：在編輯模態框中提供刪除按鈕

**技術要點**：
- 與通訊中心的功能類似，但在廠商詳細頁面中操作
- 需要在 action 函數中新增對應的 intent 處理
- 操作完成後需要重新載入廠商資料

**資料表**：
- `social_groups`（群組資料）
- `contact_windows`（聯絡窗口）

---

## 🟡 P1 重要缺口（1 個）

### 4. 黑名單標記功能
**位置**：`app/routes/vendors_.$id.tsx` - Overview Tab

**缺失功能**：
- **黑名單切換按鈕**：在廠商詳細頁面的標題區域，新增「標記為黑名單」按鈕
- **視覺標示**：黑名單廠商在名錄頁面和詳細頁面顯示特殊標記（如紅色警告圖示）
- **篩選功能**：在廠商名錄頁面可篩選黑名單廠商

**技術要點**：
- 使用 `intent="toggleBlacklist"` 處理切換操作
- 需要在 `vendors` 表新增 `isBlacklisted` 欄位（boolean）
- 黑名單廠商在 UI 上需要明顯的視覺區分
- 可能需要新增黑名單原因欄位（`blacklistReason`）

**資料表**：
- `vendors`（廠商資料）

**資料庫 Migration**：
```sql
ALTER TABLE vendors ADD COLUMN is_blacklisted BOOLEAN DEFAULT FALSE;
ALTER TABLE vendors ADD COLUMN blacklist_reason TEXT;
ALTER TABLE vendors ADD COLUMN blacklisted_at TIMESTAMP;
```

---

## 🟠 P2 中等缺口（8 個）

### 5. 廠商詳細頁面 - 驗收按鈕功能
**位置**：`app/routes/vendors_.$id.tsx` - Transactions Tab

**缺失功能**：
- **驗收按鈕**：在合作紀錄卡片上，針對「進行中」的交易顯示「驗收」按鈕
- **驗收確認**：點擊驗收按鈕後，彈出確認對話框
- **狀態更新**：確認後將交易狀態更新為「已完成」

**技術要點**：
- 使用 `intent="acceptTransaction"` 處理驗收操作
- 只有狀態為 `IN_PROGRESS` 的交易才顯示驗收按鈕
- 驗收後更新 `status` 為 `COMPLETED`，並記錄 `completedAt` 時間戳

**資料表**：
- `transactions`（合作紀錄）

---

### 6. 廠商詳細頁面 - 編輯合作紀錄
**位置**：`app/routes/vendors_.$id.tsx` - Transactions Tab

**缺失功能**：
- **編輯按鈕**：在合作紀錄卡片上新增編輯按鈕
- **編輯模態框**：點擊編輯按鈕後，開啟編輯模態框，預填現有資料
- **可編輯欄位**：
  - 專案名稱
  - 金額
  - 狀態（進行中/已完成/已取消）
  - 開始日期
  - 結束日期
  - 備註

**技術要點**：
- 使用 `intent="editTransaction"` 處理編輯操作
- 需要建立編輯模態框，預填現有資料
- 狀態使用下拉選單（IN_PROGRESS/COMPLETED/CANCELLED）

**資料表**：
- `transactions`（合作紀錄）

---

### 7. 廠商詳細頁面 - 刪除合作紀錄
**位置**：`app/routes/vendors_.$id.tsx` - Transactions Tab

**缺失功能**：
- **刪除按鈕**：在編輯模態框中提供刪除按鈕
- **刪除確認**：點擊刪除按鈕後，彈出二次確認對話框
- **刪除操作**：確認後從資料庫刪除合作紀錄

**技術要點**：
- 使用 `intent="deleteTransaction"` 處理刪除操作
- 需要二次確認，避免誤刪
- 刪除後重新載入廠商資料

**資料表**：
- `transactions`（合作紀錄）

---

### 8. 廠商詳細頁面 - 上傳勞報單
**位置**：`app/routes/vendors_.$id.tsx` - Payments Tab

**缺失功能**：
- **上傳按鈕**：在請款單卡片上新增「上傳勞報單」按鈕
- **檔案選擇**：點擊按鈕後，開啟檔案選擇對話框
- **檔案上傳**：選擇檔案後，上傳至伺服器並儲存檔案路徑

**技術要點**：
- 使用 `intent="uploadPaymentDoc"` 處理上傳操作
- 檔案上傳可使用 Base64 編碼或檔案路徑
- 需要在 `payment_requests` 表新增 `documentUrl` 欄位
- 上傳後顯示檔案名稱和下載連結

**資料表**：
- `payment_requests`（請款單資料）

**資料庫 Migration**：
```sql
ALTER TABLE payment_requests ADD COLUMN document_url TEXT;
```

---

### 9. 廠商詳細頁面 - 下載勞報單
**位置**：`app/routes/vendors_.$id.tsx` - Payments Tab

**缺失功能**：
- **下載按鈕**：在請款單卡片上，如果已上傳勞報單，顯示「下載勞報單」按鈕
- **下載操作**：點擊按鈕後，下載已上傳的勞報單檔案

**技術要點**：
- 如果 `documentUrl` 不為空，顯示下載按鈕
- 使用 `<a>` 標籤的 `download` 屬性實現下載
- 或使用 `window.open()` 開啟檔案連結

**資料表**：
- `payment_requests`（請款單資料）

---

### 10. 廠商詳細頁面 - 編輯請款單
**位置**：`app/routes/vendors_.$id.tsx` - Payments Tab

**缺失功能**：
- **編輯按鈕**：在請款單卡片上新增編輯按鈕
- **編輯模態框**：點擊編輯按鈕後，開啟編輯模態框，預填現有資料
- **可編輯欄位**：
  - 請款金額
  - 請款日期
  - 狀態（待審核/已核准/已拒絕/已支付）
  - 備註

**技術要點**：
- 使用 `intent="editPaymentRequest"` 處理編輯操作
- 需要建立編輯模態框，預填現有資料
- 狀態使用下拉選單（PENDING_APPROVAL/APPROVED/REJECTED/PAID）

**資料表**：
- `payment_requests`（請款單資料）

---

### 11. 廠商詳細頁面 - 刪除請款單
**位置**：`app/routes/vendors_.$id.tsx` - Payments Tab

**缺失功能**：
- **刪除按鈕**：在編輯模態框中提供刪除按鈕
- **刪除確認**：點擊刪除按鈕後，彈出二次確認對話框
- **刪除操作**：確認後從資料庫刪除請款單

**技術要點**：
- 使用 `intent="deletePaymentRequest"` 處理刪除操作
- 需要二次確認，避免誤刪
- 刪除後重新載入廠商資料

**資料表**：
- `payment_requests`（請款單資料）

---

### 12. 廠商詳細頁面 - 編輯/刪除聯繫紀錄
**位置**：`app/routes/vendors_.$id.tsx` - Logs Tab

**缺失功能**：
- **編輯按鈕**：在聯繫紀錄卡片上新增編輯按鈕
- **編輯模態框**：點擊編輯按鈕後，開啟編輯模態框，預填現有資料
- **可編輯欄位**：
  - 聯繫內容
  - 聯繫方式（電話/Email/LINE/會議）
  - 聯繫對象（選擇聯絡窗口）
  - 狀態（待處理/進行中/已完成）
  - 備註
- **刪除按鈕**：在編輯模態框中提供刪除按鈕

**技術要點**：
- 使用 `intent="editContactLog"` 和 `intent="deleteContactLog"` 處理操作
- 需要建立編輯模態框，預填現有資料
- 聯繫對象需要從 `contact_windows` 表載入選項
- 刪除操作需要二次確認

**資料表**：
- `contact_logs`（聯繫紀錄）

---

## 📊 修復優先順序建議

### 第一階段（P0 嚴重缺口）
1. **日常任務手動新增功能**（最簡單，獨立功能）
2. **通訊中心進階功能**（編輯/刪除群組和聯繫紀錄）
3. **廠商詳細頁面 - 通訊中心進階功能**（與第 2 項類似）

### 第二階段（P1 重要缺口）
4. **黑名單標記功能**（需要資料庫 Migration）

### 第三階段（P2 中等缺口 - 合作紀錄相關）
5. **驗收按鈕功能**（簡單的狀態更新）
6. **編輯合作紀錄**
7. **刪除合作紀錄**

### 第四階段（P2 中等缺口 - 請款單相關）
8. **上傳勞報單**（需要資料庫 Migration）
9. **下載勞報單**
10. **編輯請款單**
11. **刪除請款單**

### 第五階段（P2 中等缺口 - 聯繫紀錄相關）
12. **編輯/刪除聯繫紀錄**

---

## 🎯 下一步行動

**建議**：
1. **確認 Railway 部署成功**：先確保當前的修復已成功部署
2. **選擇修復順序**：從 P0 開始，逐步修復所有功能
3. **每完成一個功能，立即測試**：確保功能正常運作
4. **每完成一批功能，提交 Git**：保持版本控制的清晰

**預計工作量**：
- P0（3 個）：約 3-4 小時
- P1（1 個）：約 1 小時（含 Migration）
- P2（8 個）：約 6-8 小時
- **總計**：約 10-13 小時

---

**準備好開始修復了嗎？請告訴我要從哪個功能開始！** 🚀
